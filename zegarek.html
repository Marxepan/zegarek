<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Stoper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
      }
    }
    </script>
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useCallback } from 'react';
        import ReactDOM from 'react-dom/client';

        const formatTime = (timeInMs) => {
            const totalSeconds = Math.floor(timeInMs / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            const milliseconds = Math.floor((timeInMs % 1000) / 10);
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(milliseconds).padStart(2, '0')}`;
        };

        const TimerDisplay = ({ time }) => (
            <div className="text-8xl md:text-9xl font-mono tracking-tight text-cyan-300 my-4">
              {formatTime(time)}
            </div>
        );

        const ControlButton = ({ onClick, disabled = false, className, children }) => {
          const baseClasses = "w-24 h-24 rounded-full text-xl font-semibold uppercase transition-all duration-200 focus:outline-none focus:ring-4 shadow-lg";
          const disabledClasses = "opacity-50 cursor-not-allowed";
          return (
            <button onClick={onClick} disabled={disabled} className={`${baseClasses} ${className} ${disabled ? disabledClasses : ''}`}>
              {children}
            </button>
          );
        };

        const Controls = ({ isRunning, hasStarted, onStartStop, onReset, onLap }) => (
            <div className="flex justify-center items-center space-x-6 my-8">
              <ControlButton onClick={onReset} disabled={!hasStarted} className="bg-gray-700 text-white hover:bg-gray-600 focus:ring-gray-500 disabled:hover:bg-gray-700">Reset</ControlButton>
              <ControlButton onClick={onStartStop} className={isRunning ? "bg-red-600 text-white hover:bg-red-500 focus:ring-red-400" : "bg-green-600 text-white hover:bg-green-500 focus:ring-green-400"}>{isRunning ? 'Stop' : 'Start'}</ControlButton>
              <ControlButton onClick={onLap} disabled={!isRunning} className="bg-gray-700 text-white hover:bg-gray-600 focus:ring-gray-500 disabled:hover:bg-gray-700">Lap</ControlButton>
            </div>
        );

        const Laps = ({ laps }) => {
          if (laps.length === 0) return <div className="h-60 self-stretch"></div>;
          return (
            <div className="w-full max-w-md mt-8 self-stretch h-60">
              <ul className="bg-gray-800/50 rounded-lg shadow-inner overflow-y-auto h-full px-2">
                {laps.map((lap, index) => {
                  const splitTime = lap - (laps[index + 1] || 0);
                  const lapNumber = laps.length - index;
                  return (
                    <li key={lapNumber} className="flex justify-between items-center p-4 border-b border-gray-700 last:border-b-0 text-lg">
                      <span className="text-gray-400 font-medium w-1/3">Lap {lapNumber}</span>
                      <span className="font-mono text-gray-300 w-1/3 text-center">+{formatTime(splitTime)}</span>
                      <span className="font-mono text-white font-semibold w-1/3 text-right">{formatTime(lap)}</span>
                    </li>
                  );
                })}
              </ul>
            </div>
          );
        };

        const App = () => {
          const [time, setTime] = useState(0);
          const [isRunning, setIsRunning] = useState(false);
          const [laps, setLaps] = useState([]);
          const intervalRef = useRef(null);

          useEffect(() => {
            if (isRunning) {
              const startTime = Date.now() - time;
              intervalRef.current = window.setInterval(() => setTime(Date.now() - startTime), 10);
            } else if (intervalRef.current) {
              clearInterval(intervalRef.current);
            }
            return () => { if (intervalRef.current) clearInterval(intervalRef.current); };
          }, [isRunning, time]);

          const handleStartStop = useCallback(() => setIsRunning(prev => !prev), []);
          const handleReset = useCallback(() => { setIsRunning(false); setTime(0); setLaps([]); }, []);
          const handleLap = useCallback(() => { if (isRunning) setLaps(prev => [time, ...prev]); }, [isRunning, time]);

          return (
            <main className="min-h-screen bg-gray-900 flex flex-col items-center justify-center p-4 font-sans">
              <div className="w-full max-w-lg flex flex-col items-center p-8 bg-gradient-to-br from-gray-800 to-black rounded-3xl shadow-2xl shadow-black/50 border border-gray-700">
                <h1 className="text-4xl font-bold text-gray-200 mb-8 tracking-wider">Stopwatch</h1>
                <TimerDisplay time={time} />
                <Controls isRunning={isRunning} hasStarted={time > 0 || isRunning} onStartStop={handleStartStop} onReset={handleReset} onLap={handleLap} />
                <Laps laps={laps} />
              </div>
            </main>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<React.StrictMode><App /></React.StrictMode>);
    </script>
</body>
</html>
